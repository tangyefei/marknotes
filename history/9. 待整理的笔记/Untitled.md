《Linux鸟哥私房菜》- 第二部分 Linux文件、目录与磁盘格式


# 第6章 Linux的文件权限与目录配置

## 用户与用户组

- 用户身份以及该用户支持的用户租概念在Linux世界里面是相当重要的概念，特殊身份root是个万能的天神。
- Linux系统中所有的系统账号还有root相关的信息、个人密码、用户组都记录在/etc/passwd、/etc/shadow、/etc/group这三个文件中。第14章节会介绍更详细的“身份与用户组”设置。

## Linux文件权限概念

### Linux文件属性

```
$ ls -al
-rw-r-----    1 root  wheel          16384 Oct 31  2013 aliases.db
drwxr-xr-x    9 root  wheel            306 Sep 13  2013 apache2
```

以上面的输出为例解释每一列的含义

- 第1列
	- 第1个字符，`-`为文件，`d`为文件夹，还有`l`/`b`/`c`分别为链接文件、接口设备、端口设备
	- 第2到10个字符3个一组，表示了文件所有者、通用户组、其他非本用户组的read、write、execute权限
- 第2列 多少文件名连接到此节点（第8章会介绍）
- 第3列 文件的所有者账号
- 第4列 文件所属的用户组
- 第5列 文件容量大小
- 第6列 文件的创建日期或者最近修改日期
- 第7列 文件名，`.`开头表示为隐藏文件

注：一个文件夹如果你所持有的用户有`r--`权限是不能进入该目录的，必须要有个`w`权限才行

### 如何改变文件属性于权限

介绍几个常用的用于用户组、所有者、各种身份的权限的修改的命令：

- chgrp: 改变文件所属用户组
- chown: 改变文件所有者
- chmod: 改变文件的权限

注：关于这部分，其实有一些很好的练习，但是不实际操作记录笔记没有什么意义，因此只记录关键点，使用时候的问题务必返回来查询和学习

#### chgrp的例子 

```
chgrp users install.log
```

#### chown的例子 

```
chgrp bin install.log` `chgrp root:root install.log
```

#### chmod的写法稍微多样一些

- 数字类型改变权限：rwx权重分别为421，因此可以直接 `chmod 777 .bashsrc`
- 符号累心改变权限：u-user g-group o-others a-all +/-/= r/w/x
	- `chmod u=rwx,go=rx .bashsrc`
	- `chmod a+w .bashsrc`
	- `chmod a-w .bashsrc`

### 权限对于目录和文件的意义

#### 对文件而言

- r 可读取此文件的内容
- w 可编辑此文件的内容
	- 并不具备删除文件的权限，不论你修改、新增都是只是文件的内容
- x 该文件具有可以被系统执行的权限
	- Windows下文件是否可以执行是通过扩展名来判断的，在Linux下面文件是否能被执行则是通过是否有'x'这个权限来决定的。
	
#### 对目录而言

- r 具有读取目录列表的权限
- w 具有更改目录结构列表的权限
	- 新建文件夹与目录
	- 删除已经存在的文件夹与目录 - 不管该文件的权限如何
	- 将已经存在的文件或目录进行重命名
	- 转移该目录内的文件、目录位置 
- x 具有进入该目录的权限

注：很容易误解的是，很多人以为具备了`r`权限就能进入目录，实际上这只跟目录的`x`权限有关。因此要开放目录给任何人浏览时，应该至少给予`r`及`x`的权限。


##### 实例 

账户dmtsai的文件夹主目录为/home/dmtsai/，dmtsai对此目录具有 `rwx`的权限，若在此目录下有个你改为 the_root.data的文件，该文件的权限如下：
```
-rwr------    1 root  root          16384 Oct 31  2013 aliases.db
```
那么dmtsai对此文件的权限是什么？是否可以删除此文件？

答：dmtsai对于此文件是others身份，因此不具备任何全乡，但是这个文件在他的主文件夹下因此能够删除这个文件。


##### 练习

- root账户下创建/tmp/testfolder目录给定744权限
- root账户下创建/tmp/testing/testfile目录给定600权限
- 切换到普通账户tangyefei
- 进入/tmp，尝试列出/testfolder中文件，结果列出的都是`?`因为只有`r`权限没有`x`权限
- 尝试进入/testfolder中文件，提示没被授权
- 切换回root账户，将/tmp/testfolder的own设置为普通账户tangyefei
- 切换回tangyefei账户，可以列出/tmp/testfolder下的文件
- 直接删除/tmp/testing，成功！哪怕对于/tmp/testfolder/testfile没有任何权限

如果不记得了自己去操作，记得如下几个知识点：

- 切换用户 `su - account`
- `exit`退出当前用户回退到前一个用户
- 删除直接用 `rm`命令

#### 文件种类和扩展名


##### 文件种类

- 普通文件：第一个字符为`-`，按照文件内容又可以分为
	- 纯文本文件(ASCII)：内容为我们可以直接读取到的数据
	- 二进制文件(binary)：可执行文件
	- 数据格式文件(data)：程序运行过程中会读取的某些特定个事的文件
- 目录：第一个字符为`d`
- 连接文件：第一个字符为`l`，类似于快捷键
- 设备于设备文件：第一个字符为`b`，与系统外设及存储相关的文件，通常集中在/dev这个目录，分为两种
    - 块(block)设备文件：存储数据提供系统随机访问的接口，例如硬盘
    - 字符(character)设备文件：串行端口的接口设备，例如键盘、鼠标等
- 套接字(sockets)：通常被用在网络上的数据连接
- 管道(FIFO, pipe)：是一种特殊的文件类型更主要目的在于解决多个程序同时访问一个文件造成的问题 

##### 文件扩展名

- Linux的文件基本没有所谓的"扩展名"，因为能不能执行全跟他的属性有关
- 文件可以被执行和可以执行成功又是两个概念，你可以给文件`install.log`加`x`权限却不能执行成功
- 尽管如此好的命名可以让我们一看就知道文件是做什么的，因此还是已是当名字来表示它的类型

如下为几种常用的扩展名：

- *.sh：脚本或者批处理文件，使用shell写成，因此扩展名就编写为.sh
- *Z、*.tar、*.zip、*.tgz：经过压缩打包的文件，扩展名跟相应的软件有关比如 gunzip、tar等
- *.html、*.php：网页相关文件

文件名只是为了让你了解文件的用途，真正的可执行文件要能执行还需要执行权限，比如/bin/ls这个显示文件属性的命令，如果执行权限被改为`-`就无法执行了。这种问题经常发生在网络传输过程中，文件的属性权限可能被修改为不可执行。


##### Linux文件名长度限制

使用Ex2/Ex3文件系统时，针对文件名的长度限制为：
- 单一文件或目录最大容许文件名为255字符
- 包含完整路径名称及目录的完整文件名为4096字符

可以通过Tab来确认文件的文件名，学习了bash以后会发现变量是一个很好的东西。


##### Linux文件名的限制

设置文件名时最好避免一些特殊字符，因为他们是有特殊含义的，比如`.`为隐藏文件。

## Linux目录配置


### Linux目录配置标准：FHS

Filesystem Hierarchy Standard（FHS）标准的目的是为了让用户可以了解到已经安装的软件通常放置在哪个目录下，同时也希望独立软件开发商、操作系统制作者以及系统维护者都遵照FHS标准。

FHS将文件系统使用频繁与否以及是否允许用户随意改动过将目录定义为四种交互作用的形态：不可变的/可变的 和 可分享的/不可分享 分别作为两个维度来组合。

#### 目录的定义(先对其有个概念即可)：

- /（root，根目录）：与开机系统有关

	根目录是所在系统最重要的一个目录，因为所有目录都是有根目录衍伸出来的，同时根目录也与开机、还原、系统修复等有关。FHS要求希望根目录不要放在非常大的分区，因为分区越大会放入越多的数据，如此一来根目录所在分区可能会有较多发生错误的机会。

	关于根目录下面的常见子目录，有很详细的介绍，此处不做笔记，疑问时候可以翻阅page153。

- /usr(UNIX software resource)：与软件安装执行有关

	/usr里面放置的数据属于可分享不可变动的，FHS建议所有软件开发者应该将他们的数据合理地放置到这个目录下的子目录。

- /var(variable)：与系统运作有关

	如果/usr是安装时候会占用较大硬盘容量的目录，那么/var就是系统运行过程后才会渐渐占用硬盘容量的目录。

综上，由于FHS仅仅是定义出最上层的三个目录应该要放置的文件或者目录数据，因此其他的子级目录开发者可以自行配制，但是只要记住FHS的大致标准，差异性都是有限的。

### 目录树

Linux下面，所有的文件于目录都是由根目录开始的，然后一个一个分支下来，有点像是树枝状，因此我们称这种目录配置方式为目录树，它的主要特性有：
- 目录书店起始点为根目录（/,root）
- 每一个目录不知能使用本地端的文件系统，也可以使用网络上的文件系统。举例来说，可以利用Network File System(NFS)服务器挂载特定的目录结构等。
- 每一个文件名在此目录书中包含完整路径的文件名都是独一无二的。

### 绝对路径与相对路径

- 绝对路径：又根目录(/)开始写起的文件名后者目录名
- 相对路径：相对于当前路径的文件名的写法
    - `.`：代表当前的目录，可以使用`./`来表示
    - `..`：代表上一层目录，可以使用`../`来表示

### CentOS的查看

执行`# lsb_release -a`命令可以查看真实的内核版本。

# 第7章 Linux文件管理	

## 目录与路径

### 相对路径与绝对路径

要方便在相邻的目录之间切换，使用相对路径当然会比较方便。

但是作者提醒，在写程序来管理系统的条件下，务必使用绝对路径的写法，这样可以避免执行环境不同而导致的问题。这个问题在工作调度当中（at,cron第16章节）尤其重要。

### 目录的相关操作

如下是需要知道特殊目录：

- `.` 代表此层目录
- `..` 代表上层目录
- `-` 代表前一个工作目录
- `~` 代表“当前用户身份”所在的主文件件
- `~account` 代表account所在的主文件件

在根目录下直接查看目录结构会发现也有.和..的存在，只不过他们都和根目录是同一个目录。

如下介绍几个常见的处理目录的命令：

- cd: change directory
- pwd: print working directory
- mkdir: make directory
- rmdir: remove directory

#### cd 

略

#### pwd

对于链接文件要正确的文件地址需要加上`-P`参数。

```
[root@www mail]# pwd
/var/mail
[root@www mail]# pwd -P
/var/spool/mail
[root@www mail]# ls -ld /var/mail
lrwxrwxrwx. 1 root root 10 Aug 20 07:11 /var/mail->spool/mail
```

#### mkdir

- 默认情况下，多级目录需要一层一层创建，但是可以通过 `-p`参数创建多层目录
- 新建一个目录的时候会赋予默认权限，也可以使用形如 `-m 711`的形式来设定
如下为示例：

```
[root@www ~]# cd /tmp
[root@www tmp]# mkdir test
[root@www tmp]# mkdir -p test1/test2/test3/test4
[root@www tmp]# mkdir -m 711 test2
[root@www tmp]# ls -l
```


#### rmdir

使用rmdir仅能删除空目录。如果将目录下的所有东西删掉，可以使用形如`rm -r test`(貌似会不断有提示删除确认的交互)。

```
[root@www tmp]# rmdir test
[root@www tmp]# rmdir test1
rmdir: fail to remove `test1`: Directory not empty
[root@www tmp]# rmdir -p test1
rmdir: fail to remove `test1`: Directory not empty
[root@www tmp]# rmdir test1/test2/test3/test4
```

### 关于执行路径的变量:$PATH

我们执行的命令能够被识别，就是靠的$PATH变量，可以尝试分别在root身份和普通用户身份输出 `# echo $PATH`，然后查看执行结果。

可以看到各个不同的path之间使用`:`分隔，执行命令的时候会以此去这些目录中寻找可执行的命令。

####  习题1

问题：能使用一般用户身份执行ifconfig eth0这个命令吗？

答：普通用户身份下执行会出现“-bash: iconfig commmand not found”的字样，因为该命令是放在`/sbin/`下面，而个人用户中$PATH中不包含所以默认无法执行。但是，你可以通过`/sbin/ifconfig eth0`来执行这个命令。

因为系统版本（号）等的原因，上述例子执行不一定准确，但是却不妨碍我们理解一个知识点：不同的用户因为$PATH的不同所拥有的执行能力可能不一样。另外本书似乎在传递一个常规做法，更加系统相关的命令会被放置在/sbin名称目录下，而普通的软件执行命令则会放置在/bin目录下。当然但是包含sbin和bin的路径名有很多，distributions也不一定完全遵循。

####  习题2

问题：假如你是root，将ls由/bin/ls移动到/root/ls，然后进入到/root目录下。能直接执行ls命令吗？若不能应该如何执行这个命令？若要知己额输入ls即可执行又该如何进行设置？

答：

- 移动执行文件：`mv /bin/ls /root`
- 直接执行命令ls报错
- 使用绝对路径执行ls通过：`/root/ls`
- 使用相对路径执行ls通过：`./ls`
- 将/root加入PATH当中后即可直接执行 `ls：PATH="$PATH":/root`
- 记得将ls放回到/bin：`mv /root/ls /bin`


## 文件与目录管理

### 查看文件与目录

最常用的为`ls -ld`。


### 复制、移动、删除

cp命令

- 复制文件
- 创建连接文件
- 对比两个文件新旧而予以更新
- 复制整个目录

mv命令

- 移动目录与文件
- 重命名


rm命令

- 略

### 取得路径的目录名与文件名称

```
[root@www ~]# basename /etc/sysconfig/network
network
[root@www ~]# dirname /etc/sysconfig/network
/etc/sysconfig
```

## 文件内容查阅

这里介绍几个常用命令的用途：
- cat：从第一行开始显示文件内容
- tac：从最后一行开始显示，可以看出tac是cat的倒写形式
- nl：显示的时候顺便输出行号
- more：一页一页地显示文件内容
- less：与more类似，但是更有好多是它可以往下翻页
- head：只看头几行
- tail：只看结尾几行
- od：以二进制方式读取文件内容

### 直接查看文件内容

#### cat(concatenate)

、tac、nl







