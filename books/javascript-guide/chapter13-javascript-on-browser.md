JavaScript权威指南-第6版

第13章 Web浏览器端的JavaScript

本章从概述开始，介绍了JavaScript子Web文档/应用中的角色，并介绍了后续掌机还会有什么内容，解释了JavaScript代码如何嵌入HTML并执行的，最后还会介绍一兼容性、可访问性、安全性等问题。

1. 客户端JavaScript

Window对象表示浏览器的窗口或
窗体，它的属性和方法是全局变量和全局函数，Window对象上有一个window属性引用自身。

Window对象下面可以通过 location获取到Location对象，可以通过直接调用 alert 获得定义在Window的方法，因为Window对象是全局对象位于作用域链的顶端，所以可以不通过 window 而是直接引用即可。14章还会介绍在Window下的重要的属性、方法、和构造函数函数。

最重要的一个属性是document，它应用了Document对象，查询、遍历、修改文档的方法会在15掌机介绍。

每个Element元素都有stlye和className，第16章会介绍相关的编程技术。

第17章会介绍在Window\Document\Elment上的事件。

我们在Web文档里开发的JavaScript，概念开始衍生到Web应用，即围绕着浏览器的更多的高级的服务，比如18掌机介绍的XMLHttpRequest、包含在HTML5标准内的数据存储和绘制图像，还有这些都会在20-22章介绍。

2. 在HTML里嵌入JavaScript


- 内联，放在 <script>和</script>标签之间
- 放置在由<script>标签的src属性指定的外部文件中
- 放置在HTML事件处理程序中
- 放在一个URL里，这个URL使用特殊的 “javascript:”协议


一个有用的实践是可以把包含 "javascript:代码" 的链接收藏到浏览器中，浏览器会执行代码中的内容，有两点需要注意：几遍代码是多行写成的，HTML也会把它解析成一行，并且在其中的//注释是无效；另外注意代码里面不能包含href所使用等值的引号。

3. JavaScript程序的执行

Web页面包含使用iframe嵌入的窗体，文档和被嵌入的文档会有不同的全局对象，但是如果文档来自于同一个服务器，两个文档上是可以交互的，你可以把它当做一个程序的两个不同部分，在14.8.3节会介绍。

JavaScript的程序执行有两个阶段，第一阶段载入文档内容，并按照文档中（并不总是）中的出现顺序执行；第二阶段Web浏览器调用事件处理程序来响应异步发生的事件，它可以是用户操作，也可以是网络活动或者代码中的错误来触发。13.3.4节会介绍这两个阶段。

脚本和事件处理程序在同一时间只Web能执行一个，没有并发性，在13.3.3节会介绍单线程执行模型。

3.1 同步、异步和延迟的脚本

当HTML解析器遇到`<script>`元素时，它默认必须先执行脚本，然后在恢复文档的解析和渲染。

可以使用defer和async属性来改变脚本的执行方式，即浏览器会下载脚本时继续解析和渲染文档。它们都是不带值的布尔属性，出险在<script>标签里即可。

defer属性使得浏览器延迟脚本执行，知道翁当的载入和解析完成。

async属性是的浏览器尽可能快地执行脚本，而不用在下载脚本时阻塞文档解析。

defer的脚本会按照他们在文档中的出现顺序执行，async会在它们载入后就执行，意味着它们可能是无序的。

作者提示使用它们的时候，考虑浏览器的实际实现成都。

在不支持的async浏览器中，可以通过动态创建<script>元素并把它插入文档中，来实现脚本的异步载入和执行。


3.2 事件驱动的JavaScript

事件和时间处理是第17章的内容，这一节提供一个快速概览。

3.3 客户端JavaScript线程模型

HTML5定义了一种作为后台线程的 "Web Worker",单客户端JavaScript还是像严格的单线程一样工作，甚至可能并发执行的时候，客户端JavaScript也不会知道是否真的有并行逻辑在执行。

单线程的执行是为了让编程更简单，意味着浏览器在事件处理程序执行时停止用户输入，如果脚本和时间处理程序太长时间，可能带来的影响有：用户无法在脚本完成前看到文档内容；浏览器无法响应，让用户人为浏览器崩溃了。对应的处理是应该在有较多的计算导致延迟之前，将文档完全载入，并且能在计算机计算的时候告知用户浏览器没有挂起。

22.4节介绍了Web worker的更多信息，它是用来执行秘籍任务而不冻结用户界面的后台线程。

**项目中的响应速度慢是否可以从上述描述中得到启发，是什么运算导致了界面卡顿，如何使用浏览器自带的工具来侦测导致卡顿的原因，是否可以使用Web work来做一些优化**

3.4 客户端JavaScript时间线

1. 浏览器创建Document对象，解析Web页面，document.readystate的值是loading
2. 遇到不到async和defer属性的<script>元素时，将他们添加到文档中并开始执行，同时文档的解析器会停止，脚本就可以使用document.write来操作文档结构，这些脚本（同步脚本）可以看到它自己的<script>和它们之前的文档内容。
3. 遇到async属性的<script>元素时候，会下载脚本并继续解析文档，并且脚本会在下载完成后尽快执行，异步脚本精致实用docuemnt.write()方法。
4. 文档完成解析时，document.readyState编程interactive
5. 所有的defer脚本会按照在文档中的出现顺序执行，一步脚本可能会在这个时间执行，延迟脚本能访问完整的文档树，精致实用docuemnnt.write方法（**为什么，这有点奇怪呀？**）
6. 浏览器在Document对象上触发DocumentContentLoad事件，标志着程序执行从同步执行阶段转化到了异步时间驱动阶段。
7. 文档完全解析完成，单可能还在等待其他内容的载入，比如图片，当所有这些尼日弄个载入，并且所有异步脚本完成载入和执行时，document.readyState编程complete，Web浏览器触发Window对象上的load事件。
8. 开始调用异步事件，异步响应用户输入、网络时间、计时器等。

如上是理想的时间线，具体文档扫盲时候对用户，浏览器扫盲时候必须开始响应用户输入，没有明确指定，根据不同的浏览器实现而有所不同。

4. 兼容性和互用性

问题可以归为三类

演化：发展演变中，新餐刀的特性、API被实现，老版本的浏览器不支持。
未实现：不同浏览器对于特性是否有必要实现存在观点上的差异
bug：浏览器自身存在bug或并没有按照规范准确地实现API

本节提供了一些可能有助于解决兼容性问题的网站，以及一些具体的解决兼容性问题的策略，遇到的时候可以细看。

5. 可访问性

用很小的篇幅概述了让有视觉障碍或肢体困难的用户正确获取信息的相关只是。

6. 安全性

6.1 JavaScript不能做什么
6.2 同源策略
6.3 脚本化插件和ActiveX控件
6.4 跨站脚本
6.5 拒绝服务攻击


**自己对于浏览器的iframe之间通信可以采用方式、限制条件还不够熟悉**

7. 客户端框架

框架发展日新月异，该部分的介绍颇有点过时，略。




