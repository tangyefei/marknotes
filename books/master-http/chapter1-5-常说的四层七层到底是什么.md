# 5. 常说的四层、七层到底是什么？


TCP/IP协议族是一个有层次的协议，下面将会弄懂它的层次模型，并且能回答常见的诸如 “七层负载均衡”、“四层负载均衡”、“二层转发”、“三层路由”等说法。

## TCP/IP网络分层模型

![四层模型](https://blog-1258030304.cos.ap-guangzhou.myqcloud.com/books/master-http/http-four-level-model.jpeg)

它的层次是从下往上，所以第一层是最下面的一层，下面是对各层的介绍：

1. 第一层，链接层(link layer)，负责在底层网络发送原始数据包，工作在网卡层次，使用Mac地址来标记设备因此也叫Mac层
2. 第二层，网际层(internet layer)，用IP地址取代Mac地址，把网络设备连接起来，IP协议就在这一层
3. 第三层，传输层（transport layer），保证额数据在IP地址标记的两点之间可靠地传输，TCP在这一层
4. 第四层，应用层（application layer)，有各种面向具体应用的协议，比如Telnet，SSH，FTP，SMTP，HTTP

其中Mac层的传输单位是帧（frame)，IP层的参数单位是包（packet),TCP层的传输单位是段（segment），HTTP的传输单位是报文。

这里需要简单介绍下TCP和UDP的区别：

- TCP需要先建立连接然后才能发送数据，而且保证数据不丢失不重复，数据是字节流哟U先后顺序
- UDP不需要建立连接就可以发送任意数据，但不保证一定会发到对方，数据是分散的小数据包，乱序发乱序收

## OSI网络分层模型


70年代国际标准组织注意到网络协议比较乱，所以设计出网络分层模型，想用它来统一各种网络协议。

![七层模型](https://blog-1258030304.cos.ap-guangzhou.myqcloud.com/books/master-http/http-seven-level-model.jpeg)

因为实际上很多协议已经在使用了，所以该模型发布的时候就明确表示作为“参考”不强制，它的优点是在理论层面上描述网络更加完整。

并且它的规约是直接用第N层来描述，这样比具体名字更快捷。

综上，四层、七层的说法就逐渐传开了。

## 两个分层模型的对应关系

![七层模型](https://blog-1258030304.cos.ap-guangzhou.myqcloud.com/books/master-http/http-compare-model.jpeg)

可以参考上图看到他们的对应关系

- OSI的第一层物理层，在TCP/IP里面无对应
- OSI的第二层数据链路层，对应TCP/IP里的链接层
- OSI的第三层网络层，对应TCP/IP里的网际层
- OSI的第四层传输层，对应TCP/IP里的传输层
- OSI的第五、六、七层，对应TCP/IP里的应用层

OSI在第四层以上分得很细，实际上很多应用的OSI五、六、七层经常联系的很紧密很难能分开。
 
## TCP/IP协议栈的工作方式
 

![协议栈的工作方式](https://blog-1258030304.cos.ap-guangzhou.myqcloud.com/books/master-http/http-model-workflow.jpeg)


简述就是每一层都会给数据加上自己的头，一层一层往下传递然后发送，接收方则一层一层剥离头，往上传递。

## 补充

关于如何区分协议所在层次的，凡事由操作系统处理的就是四层或四层以下，凡事由应用程序处理的就是第七层。

TCP/IP协议之外，还有一些协议是位于OSI第五层、六层的。

## 思考

到此，尝试回答开篇提到的问题：

- 七层负载均衡：工作在应用层，用适当的策略转发给后端服务器
- 四层负载均衡：工作再传输层的对后端服务器的负载均衡
- 二层转发：数据链路层，查找目标Mac地址，进行数据转发
- 三层路由：网络层，解析数据包头信息，找到目标IP地址，转发数据
- DNS协议位于那一层：应用层
- CDN工作在哪一层：应用层

思考：应用哪些协议的传输速度会更快呢？层次走的越多，安全处理越多，越可靠，响应地会越慢。·














