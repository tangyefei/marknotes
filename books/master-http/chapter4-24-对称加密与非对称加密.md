# 24 对称加密与非对称加密


上节介绍了通信过中"安全"的四特性：机密性、完整性、身份认证、不可否认。本节将将介绍TLS是如何实现机密性的。

## 加密

加密是把明文，使用密钥，基于加密算法，加密成密文的过程，接收方拿到密文，使用密钥再进行解密。

加密算法是公开的，关键是保持密钥的私密性，通常约定俗成地说法是 多少位(bit)的密钥，比如密钥长度是128，等与16字节。

## 对称加密 

如果加密和解密使用的都是同一个密钥，那就是对称加密，它的问题是密钥可能在传输途中被窃取。

目前最常用的对称加密算法那是 AES 和 ChaCha20。

## 加密的分组模式

假定使用的加密算法是 AES-128，密钥长度等于16字节，那么明文会被分为16字节一组，然后每个组用密钥进行加密。

分组模式最早由ECB、CBC、CFB、OFB，最新的分组模式有AEAD，常用但是GCM、CCM、Poly1305。

下面例子中使用，128位的密钥，16字节，1个字节表示为2个十六进制，因此字符

```
https://www.chrono.com/24-1?key=123456

algo  = aes_128_cbc
plain = hello openssl
enc   = 93a024a94083bc39fb2c2b9f5ce27c09
dec   = hello openssl
```
## 非对称加密



非对称加密是为了解决密钥可能被窃取而出现的，它有公钥和私钥，两个密钥是不同的，公钥可以给任何人使用，私钥必须严格保密。

虽然他们都能用来加密解密，但是公钥加密后只能用私钥解密，同理私钥加密后只能用公钥解密。

因此网站秘密保管私钥，公钥可以在网上任意分发，黑客哪怕获取到了报文，因为没有私钥，也没法解密。

非对称加密算法设计比对称算法难得多，在TLS中最著名的是RSA、ECC。

## 混合加密


非对称加密虽然没有“密钥交换”的问题，但是运算速度很慢，对所有明文基于非对称加密并不实用。

TLS里使用的是混合加密，简单来说就是：

- 通信双方一方使用公钥，一方使用私钥
- 一方生成会话密钥，然后用公钥加密
- 一方接收到密文，用私钥解密，得到会话密钥，该过程是非对称的加密解密
- 后续通信都基于会话密钥，基于对称加密进行通信

## 思考

既然私钥加密过的数据，任何公钥都可以解密，这样的机制有什么实际用途呢？

答：公钥加密私钥解密，私钥签名公钥验证。上述机制更多是用来验证身份。