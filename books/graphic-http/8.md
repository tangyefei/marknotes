

# 第8章 认证

## 何为认证

为了确认访问者是否有访问系统的权限，需要客户端提供一些能自证身份的信息，核对的信息通畅包含：
- 密码：仅本人知道的字符串信息
- 动态令牌：本人持有的设备显示的一次性密码
- 数字证书：仅限本人终端持有的信息
- 生物认证：指纹和虹膜等生理信息
- IC卡

HTTPS使用的认证包括如下分类，后面将对分类进行细致介绍
- Basic认证
- DIGEST认证
- SSL客户端认证
- FormBase认证

## Basic认证

**Basic认证的特点**

- 是从HTTP/1.0就开始的认证方式，仍旧有一部分网站使用这种认证方式。
- 认证过程采用base64编码，但未采用加密处理，通信线路上只要被窃听，信息被盗取的可能性极高。
- 想再一次进行认证时，一般浏览器无法实现认证注销操作。
- 认证不够灵活，并且达不到大多数网站的安全等级，因此并不常用


**Basic认证的步骤**

  - 请求需要Basic认证服务器会返回401 Authorization Required，包含WWW-Authentication的首部字段，字段包含认证方式（Basic）和安全域字符串（realm）。`注：没太理解返回字段的结构`
  - 客户端将用户名和密码拼接好，然后用base64处理过后，设置为Authentication的值发送给服务器。
  - 服务器对认证信息进行认证，如果通过，返回一条包含REQUEST-URI资源的响应。

## Digest认证

- Digest认证同样采用质询响应的方式，但是不会直接发送明文的密码
- Digest认证安全等级高于Basic，但跟HTTPS相比仍是很弱，它提供了用户密码被窃听的机制，但是没法识别用户伪造
- 使用上不那么灵活，并且仍旧达不到大多数网站的安全需求

**Digest认证的步骤**
  - 请求需要Basic认证服务器会返回401 Authorization Required，包含WWW-Authentication的首部字段，字段包含临时质询码nonce。
- 客户端在在首部字段Authorization包含username、realm、nonce、uri 和 response的字段信息。
- 服务器接收到后确认认证信息的正确性，并返回包含REQUEST-URI资源的响应。

## SSL客户端认证

经由HTTPS客户端的证书完成的认证方式。需要实现将证书分发给客户端，并且客户端安装了此证书：
- 服务器发送Certificate Request的报文，要求客户端提供证书
- 用户选择了发送证书以后，证书会以Client Certificate的报文方式发送给服务端
- 服务端验证证书通过后领取到证书内的公开秘钥，然后开始HTTPS加密通信

通常客户端认证会采取双认证的方式，即用SSL客户端证书来认证客户端计算机，用密码来确定这是用户本身的行为。

## 基于表单认证

由于便利性和安全性的问题，Basic认证和Digest认证几乎不怎么使用。另外SSL客户端认证虽然具有比较高的安全等级，但因为导入和费用等问题未得到普及。

对于Web网站的认证功能，满足安全级别的标准规范并不存在，所以只好实现基于表单的认证方式，不同的网站有不同的实现方式，如果有充分的考虑可能具有比较高的安全等级。大致步骤是
- 用户把认证所需信息放在报文实体，以HTTPS的方式发送给服务器
- 通过验证用户发送过来的信息，把认证状态跟为当前用户生成的SessionID绑定起来。
- 在返回响应给客户端时，在首部Set-Cookie字段中写入Sesssion-ID，为了减少跨站脚本攻击，建议在在Cookie内加上httponly属性
- 客户端接收到Sessoin-ID以后，会将它当做Cookie保存在本地，下次发送请求的时候就会自动带上Cookie值
