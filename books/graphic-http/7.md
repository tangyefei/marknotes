
# 第7章 确保Web安全的HTTPS

## 7.1 内容窃听

通信使用明文（不加密），内容可能会被窃听。TCP/IP协议族的工作机制，通信内容在所有通信线路上都有可能遭窃听，及时信息是加密处理后的，加密处理后的信息本省还是会被人看到的。

防止窃听中最普及的是加密技术，加密对象可有有： 

**通信的加密**

可以通过SSL（Secure Socket Layer）或TLS（Transport Layer Security）组合使用加密通信内容。与SSL组合使用的HTTP被称为HTTPS（HTTP Secure）或HTTP over SSL。

SSL是“Secure Sockets Layer”的缩写，中文叫做“安全套接层”。它是在上世纪90年代中期，由网景公司设计的。到了1999年，SSL 因为应用广泛，已经成为互联网上的事实标准。IETF 就在那年把 SSL 标准化，标准化之后的名称改为 TLS（Transport Layer Security），中文叫做“传输层安全协议”。SSL/TLS可以视作同一个东西的不同阶段。

**内容的加密** 

把HTTP报文里的内容进行加密，客户端需要加密处理后再发送请求。使用的前提是客户端和服务器端同时具备加密和解密机制。

### 7.2 请求伪装

HTTP请求是不会对通信方进行确认的，**任何人都可以发起请求**，服务器接收到请求，不管对方是谁都会返回一个响应（服务器端设定了IP地址和端口号例外），因此存在如下隐患：
- Web服务器坑你是伪造的
- 客户端可能是伪造的
- 通信对象可能不具备访问权限
- 不知道请求来自何方
- 容易遭受海量请求的DoS攻击

SSL不仅提供了加密处理，而且他提供了一种称为证书（由值得信任的第三方颁发）的手段，用于确认服务器和客户端是实际存在的。


### 7.3 请求篡改

因为HTTP协议无法验证报文的完整性，因此响应内容遭到篡改后也没办法获
悉。这种攻击叫做中间人攻击（Man-in-the-Middle attack）。

最常用的是使用MD5 和 SHA-1等散列值校验的方法，以及用来确定文件的数字签名的方法，这些方法不能百分百确定结果正确。

## 7.4 HTTP+加密+认证+完整保护=HTTPS

HTTPS并非新的协议，而是HTTP通信接口部分用SSL和TLS协议代替而已。即HTTP不再是直接和TCP通信，而是先和SSL通信，再由SSL和TCP通信。运行在应用层的SMTP和Telnet等协议均可以配合SSL协议使用，可以说SSL是当今世界上最广泛的网络安全技术。

### 公开秘钥加密

近代**共享秘钥加密方法**（也叫堆成秘钥加密）中，加密算法是公开的，秘钥却是保密的，通过这种方式用以确保加密的安全性。但任何人只要持有秘钥就能解密了因此如何将秘钥安全的转交给对方。

公开密钥加密很好地解决了这个问题，它使用一堆非对称的秘钥，发送密文的一方使用公开秘钥进行加密处理，对方接受到加密的信息以后使用私有秘钥进行解密。这样做的好处是不需要发送用来解密的私有秘钥。

HTTPS通常采用混合加密的机制。因为公开密钥加密的处理与共享秘钥相比，处理速度要慢，因此通常（1）使用公开秘钥安全地交换一些敏感信息，比如后续通信要用到的共享秘钥加密中的秘钥（2）然后使用共享秘钥方式进行通信。

#### 存在的问题

公开秘钥加密还是存在一些问题的，比如无法证明公开密钥本身就是货真价实的。为了解决上述问题，可以使用数字认证机构（CA，Certificate Authority）和相关机构颁发的公开秘钥证书。作为延伸可以了解
- 公开密钥证书的颁发和使用过程
- 可证明组织真实性的EV SSL证书
- 可证明客户端的客户端证书
- 认证机构如果遭到攻击会撼动SSL的可信度
- 自由认证机构颁发的证书成为自签名证书
- 中级认证机构的证书被植入，在不同浏览器上可能受到不同的对待

## 7.3 HTTPS安全通信的步骤

![image.png](https://upload-images.jianshu.io/upload_images/134602-387068deaace40d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

因为步骤的介绍中有，很多新的概念和词汇，这里不做细述，需要用到的时候再自行查看每一步的描述内容。

## 7.4 SSL的慢

通信慢，因为SSL部分既要消耗网络资源又要对通信进行处理，所以时间上延长了，和使用HTTP相比，网络负载会慢到2到100倍。

处理慢，因为需要涉及客户端和服务端的加密解密处理，需要消耗CPU及内存等资源，导致负载增加。

因为HTTPS安全可靠但慢，所以对于不包含敏感信息的网站，或者不愿意承从认证机构中购买证书的开销的公司，可能只会选择HTTP通信方式。

对于速度慢这一问题，并没有根本性的解决方案，会使用SSL加速器这种专用服务器来改善问题，它为SSL通信的专用硬件，能够提高SSL的运算速度。

